define("profilefield_learningstyles/main",["exports","jquery","core/modal_factory","core/modal_events","core/ajax","core/log","core/str"],(function(_exports,_jquery,_modal_factory,_modal_events,_ajax,_log,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * BuyBee repository module to encapsulate all of the AJAX requests that can be sent for BuyBee.
   *
   * @module      profilefield_learningstyles
   * @copyright   2024 David Herney @ BambuCo - https://bambuco.co
   * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_log=_interopRequireDefault(_log);var defaultContainer="#profilefield_learningstyles-index",questionStructure=[],strings=[{key:"info"},{key:"errorsaving",component:"profilefield_learningstyles"},{key:"nomorecourses",component:"profilefield_learningstyles"}],s=[];_exports.init=async structureJSON=>{questionStructure=JSON.parse(structureJSON),strings.forEach((one=>{s[one.key]=one.key})),(0,_str.get_strings)(strings).then((function(results){var pos=0;return strings.forEach((one=>{s[one.key]=results[pos],pos++})),!0})).fail((function(e){_log.default.debug("Error loading strings"),_log.default.debug(e)}));var currentpage=0,currentview="fys",$maincontainer=(0,_jquery.default)(defaultContainer),$progressinner=$maincontainer.find("#progressinner"),$toleft=$maincontainer.find("#controlbar .toleft"),$toright=$maincontainer.find("#controlbar .toright"),$viewslistglobal=$maincontainer.find("#viewslistglobal"),moving=!1,$allpages=[],i=0;$maincontainer.find("#pageslist .onepage").each((function(){var $thispage=(0,_jquery.default)(this);$allpages.push($thispage),$thispage.hasClass("active")&&(currentpage=i),i++,$thispage.find(".questionoptions button").on("click",(function(){var $button=(0,_jquery.default)(this),$container=$button.parents(".questionoptions"),type=$button.data("type");$maincontainer.find('.onepage[data-index="'+$thispage.data("index")+'"] .checked').removeClass("checked"),$container.find(".option"+type).addClass("checked"),setTimeout((function(){$toright.trigger("click")}),400)}))}));var getCurrentPage=function(){return $allpages[currentpage]},changeView=function(viewkey){currentview=viewkey,$maincontainer.find(".eachview").hide(),$maincontainer.find('.eachview[data-view="'+viewkey+'"]').show(),$viewslistglobal.find("li").removeClass("active"),$viewslistglobal.find('li[data-changeview="'+viewkey+'"]').addClass("active")},setBoard=function(){var $current=getCurrentPage();"info"==$current.data("type")?($maincontainer.find("#testfooter").hide(),$viewslistglobal.hide()):($maincontainer.find("#testfooter").show(),$viewslistglobal.show()),0==currentpage?$toleft.hide():$toleft.show(),currentpage+1>=$allpages.length?$toright.hide():0==$current.find(".testquestion").length||$current.find(".questionoptions .checked").length>0?$toright.show():$toright.hide();var percent=100*currentpage/$allpages.length;$progressinner.css("width",percent+"%"),$current.find(".test-results, .stylefeedback").length>0&&drawResults(defaultContainer)};$toleft.on("click",(function(e){(e.preventDefault(),0==currentpage||moving)||(moving=!0,getCurrentPage().hide(200,(function(){currentpage--,getCurrentPage().show(200,(function(){moving=!1})),setBoard()})))})),$toright.on("click",(function(e){if(e.preventDefault(),currentpage+1!=$allpages.length&&!moving){var $current=getCurrentPage();moving=!0,$current.hide(200,(function(){currentpage++,($current=getCurrentPage()).show(200,(function(){moving=!1})),setBoard()}))}})),$maincontainer.find("[data-go]").on("click",(function(e){e.preventDefault();var action=(0,_jquery.default)(this).data("go");switch(action){case"next":$toright.trigger("click");break;case"previous":$toleft.trigger("click");break;default:if(!isNaN(action)&&!isNaN(parseInt(action))){moving=!0;var $current=getCurrentPage();$current.hide(200,(function(){currentpage=parseInt(action),($current=getCurrentPage()).show(200,(function(){moving=!1})),setBoard()}))}}})),$maincontainer.find(".test-btns-save[data-sesskey]").on("click",(function(){var answers=getAnswers(),sesskey=(0,_jquery.default)(this).data("sesskey");saveInfo(answers,sesskey,(function(){$toright.trigger("click")}))})),$maincontainer.find("[data-changeview]").on("click",(function(e){e.preventDefault();var viewkey=(0,_jquery.default)(this).data("changeview");changeView(viewkey)})),setBoard(),changeView(currentview)};var showMessage=function(message){let type=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",callback=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,modalTitle="",content=message;switch(type){case"info":modalTitle=s.info,content="<p>"+message+"</p>";break;case"help":modalTitle="",content='<div class="test-help">'+message.html()+"</div>"}return _modal_factory.default.create({type:_modal_factory.default.types.CANCEL,body:content,title:modalTitle}).then((function(modal){return modal.setButtonText("cancel","Ok"),modal.getRoot().on(_modal_events.default.hidden,(function(){callback&&callback(),modal.getRoot().remove()})),modal.show(),modal}))},saveInfo=function(answers,sesskey){let callback=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return answers=JSON.stringify(answers),_ajax.default.call([{methodname:"profilefield_learningstyles_save",args:{answers:answers,sesskey:sesskey},done:function(data){data?callback&&callback():showMessage(s.errorsaving)},fail:function(e){showMessage(e.message)}}])},drawResults=maincontainer=>{maincontainer&&""!=maincontainer||(maincontainer=defaultContainer);var $maincontainer=(0,_jquery.default)(maincontainer),$container=$maincontainer.find(".test-results");calcAffinity($maincontainer),questionStructure.forEach((group=>{let $bar=$container.find('[data-style="'+group.key+'"] .bar'),$indicator=$bar.find("> div"),percent=100*(group.affinity+11)/22,barwidth=$bar.width(),left=(barwidth-barwidth/12)*percent/100;$indicator.css("left",left+"px"),group.styles.forEach((style=>{let affinity=Math.abs(group.affinity),level=affinity<4?3:affinity<8?2:1;$maincontainer.find('.stylefeedback[data-style="'+style+'"] [data-level="'+level+'"]').show()}))}))},getAnswers=maincontainer=>{maincontainer&&""!=maincontainer||(maincontainer=defaultContainer);var $maincontainer=(0,_jquery.default)(maincontainer),answers=[];return $maincontainer.find('.onepage[data-type="style"]').each((function(){let $stylepage=(0,_jquery.default)(this),$checked=$stylepage.find(".questionoptions > .checked");answers.push({index:$stylepage.data("index"),view:$checked.parents(".eachview").data("view"),value:$checked.find("button[data-type]").data("type")})})),answers},calcAffinity=$maincontainer=>{var answers=getAnswers($maincontainer);questionStructure.forEach((group=>{var checkeda=0,checkedb=0;group.questions.forEach((index=>{var answer=answers.find((item=>item.index==index));void 0!==answer&&"undefined"!==answer.value&&("a"==answer.value?checkeda++:checkedb++)})),group.affinity=checkedb-checkeda}))}}));

//# sourceMappingURL=main.min.js.map